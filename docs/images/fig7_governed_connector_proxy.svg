<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 550" font-family="Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6a4fa5"/>
    </marker>
  </defs>

  <text x="550" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#1a1a2e">Figure 7: Governed Connector Proxy ‚Äî Data Flow</text>
  <text x="550" y="50" text-anchor="middle" font-size="11" fill="#666">Connectors never make network calls directly ‚Äî all external requests mediated by governance proxy</text>

  <!-- Agent -->
  <rect x="40" y="100" width="150" height="50" rx="25" fill="#1a1a2e" stroke="#333" stroke-width="2"/>
  <text x="115" y="130" text-anchor="middle" font-size="12" font-weight="bold" fill="#4ade80">AGENT</text>

  <path d="M190 125 L235 125" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Connector (produces spec, NOT network call) -->
  <rect x="238" y="80" width="180" height="90" rx="6" fill="#f5f0ff" stroke="#6a4fa5" stroke-width="2"/>
  <text x="328" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#6a4fa5">CONNECTOR</text>
  <line x1="258" y1="112" x2="398" y2="112" stroke="#6a4fa5" stroke-width="1"/>
  <text x="328" y="130" text-anchor="middle" font-size="9" fill="#444">Email | Slack | Calendar | REST</text>
  <text x="328" y="148" text-anchor="middle" font-size="9" fill="#6a4fa5" font-weight="bold">Produces HTTP Request Spec</text>
  <text x="328" y="162" text-anchor="middle" font-size="9" fill="#c0392b" font-weight="bold">‚ùå NO direct network calls</text>

  <path d="M418 125 L460 125" stroke="#6a4fa5" stroke-width="2" marker-end="url(#arrow-purple)"/>
  <text x="440" y="115" text-anchor="middle" font-size="8" fill="#6a4fa5">Request</text>
  <text x="440" y="140" text-anchor="middle" font-size="8" fill="#6a4fa5">Spec</text>

  <!-- GOVERNED CONNECTOR PROXY (large box with steps) -->
  <rect x="463" y="60" width="350" height="380" rx="8" fill="#faf5ff" stroke="#6a4fa5" stroke-width="2.5"/>
  <text x="638" y="85" text-anchor="middle" font-size="13" font-weight="bold" fill="#6a4fa5">GOVERNED CONNECTOR PROXY</text>
  <line x1="483" y1="92" x2="793" y2="92" stroke="#6a4fa5" stroke-width="1.5"/>

  <!-- Step 1: Validate -->
  <rect x="483" y="102" width="310" height="32" rx="4" fill="#e8dff5" stroke="#6a4fa5" stroke-width="1"/>
  <text x="498" y="122" font-size="10" font-weight="bold" fill="#4a3680">1.</text>
  <text x="515" y="122" font-size="10" fill="#1a1a2e">Validate against connector declared capabilities</text>

  <!-- Step 2: Classify -->
  <rect x="483" y="140" width="310" height="32" rx="4" fill="#e8dff5" stroke="#6a4fa5" stroke-width="1"/>
  <text x="498" y="160" font-size="10" font-weight="bold" fill="#4a3680">2.</text>
  <text x="515" y="160" font-size="10" fill="#1a1a2e">Classify risk tier (default + Trust Ledger)</text>

  <!-- Step 3: Soul eval -->
  <rect x="483" y="178" width="310" height="32" rx="4" fill="#e8dff5" stroke="#6a4fa5" stroke-width="1"/>
  <text x="498" y="198" font-size="10" font-weight="bold" fill="#4a3680">3.</text>
  <text x="515" y="198" font-size="10" fill="#1a1a2e">Evaluate against Soul governance rules</text>

  <!-- Step 4: Allowlist -->
  <rect x="483" y="216" width="310" height="32" rx="4" fill="#e8dff5" stroke="#6a4fa5" stroke-width="1"/>
  <text x="498" y="236" font-size="10" font-weight="bold" fill="#4a3680">4.</text>
  <text x="515" y="236" font-size="10" fill="#1a1a2e">Check domain against Network Allowlist</text>

  <!-- Step 5: Approval -->
  <rect x="483" y="254" width="310" height="32" rx="4" fill="#f8d7da" stroke="#a54a4a" stroke-width="1"/>
  <text x="498" y="274" font-size="10" font-weight="bold" fill="#721c24">5.</text>
  <text x="515" y="274" font-size="10" fill="#721c24">Request owner approval (if T3)</text>

  <!-- Step 6: Execute with vault -->
  <rect x="483" y="292" width="310" height="32" rx="4" fill="#d4edda" stroke="#2d8a4e" stroke-width="1.5"/>
  <text x="498" y="312" font-size="10" font-weight="bold" fill="#155724">6.</text>
  <text x="515" y="312" font-size="10" font-weight="bold" fill="#155724">Execute with Credential Vault creds</text>

  <!-- Step 7: Strip -->
  <rect x="483" y="330" width="310" height="32" rx="4" fill="#e8dff5" stroke="#6a4fa5" stroke-width="1"/>
  <text x="498" y="350" font-size="10" font-weight="bold" fill="#4a3680">7.</text>
  <text x="515" y="350" font-size="10" fill="#1a1a2e">Strip secrets and PII before logging</text>

  <!-- Step 8: Receipt -->
  <rect x="483" y="368" width="310" height="32" rx="4" fill="#fff8f0" stroke="#c4762b" stroke-width="1"/>
  <text x="498" y="388" font-size="10" font-weight="bold" fill="#c4762b">8.</text>
  <text x="515" y="388" font-size="10" fill="#1a1a2e">Generate receipt with full governance chain</text>

  <!-- Step 9: Return -->
  <rect x="483" y="406" width="310" height="24" rx="4" fill="#e8dff5" stroke="#6a4fa5" stroke-width="1"/>
  <text x="498" y="422" font-size="10" font-weight="bold" fill="#4a3680">9.</text>
  <text x="515" y="422" font-size="10" fill="#1a1a2e">Return response to connector</text>

  <!-- External Service -->
  <rect x="880" y="280" width="170" height="60" rx="6" fill="#e8e8e8" stroke="#888" stroke-width="2"/>
  <text x="965" y="305" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">EXTERNAL</text>
  <text x="965" y="322" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">SERVICE</text>
  <text x="965" y="350" text-anchor="middle" font-size="9" fill="#666">Gmail, Slack, etc.</text>

  <path d="M813 310 L878 310" stroke="#2d8a4e" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="845" y="302" text-anchor="middle" font-size="8" fill="#2d8a4e">HTTPS</text>

  <!-- Credential Vault -->
  <rect x="880" y="140" width="170" height="70" rx="6" fill="#1a1a2e" stroke="#c4762b" stroke-width="2"/>
  <text x="965" y="165" text-anchor="middle" font-size="11" font-weight="bold" fill="#c4762b">üîí CREDENTIAL</text>
  <text x="965" y="182" text-anchor="middle" font-size="11" font-weight="bold" fill="#c4762b">VAULT</text>
  <text x="965" y="200" text-anchor="middle" font-size="9" fill="#aaa">Encrypted | Scoped Access</text>

  <path d="M880 180 L813 285" stroke="#c4762b" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="855" y="225" text-anchor="middle" font-size="8" fill="#c4762b" transform="rotate(-35 855 225)">Creds at execution only</text>

  <!-- Key insight callout -->
  <rect x="40" y="460" width="1010" height="70" rx="6" fill="#fff8f0" stroke="#c4762b" stroke-width="1.5"/>
  <text x="550" y="483" text-anchor="middle" font-size="11" font-weight="bold" fill="#c4762b">KEY ARCHITECTURAL INSIGHT</text>
  <text x="550" y="502" text-anchor="middle" font-size="10" fill="#444">Connectors produce request specifications. The Proxy decides whether, when, and how to execute them.</text>
  <text x="550" y="518" text-anchor="middle" font-size="10" fill="#444">Credentials never touch the LLM context, agent memory, or log output. Secrets are isolated by architecture, not policy.</text>

  <!-- Response path back -->
  <path d="M463 430 L328 430 L328 170" stroke="#888" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow)"/>
  <text x="380" y="445" text-anchor="middle" font-size="8" fill="#888">Response</text>
</svg>
